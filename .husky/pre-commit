#!/bin/sh

# ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
changed_files=$(git diff --cached --name-only)

# í”„ë¡œì íŠ¸ ê²½ë¡œ ì„¤ì •
frontend_project_path="frontend/"
backend_project_path="backend/"

# í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼ ë³€ê²½ í™•ì¸
frontend_changes=$(echo "$changed_files" | grep "$frontend_project_path" || true)

# ë°±ì—”ë“œ íŒŒì¼ ë³€ê²½ í™•ì¸
backend_changes=$(echo "$changed_files" | grep "$backend_project_path" || true)

# í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ TypeScript, ESLintì™€ Prettier ê²€ì‚¬ ì‹¤í–‰
if [ ! -z "$frontend_changes" ]; then
  echo "ğŸ§¼ í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ ê°ì§€: TypeScript, ESLint, Prettier ê²€ì‚¬ ì‹¤í–‰ ì¤‘..."
  cd $frontend_project_path

  # TypeScript ê²€ì‚¬ (ì»´íŒŒì¼ë§Œ, ì¶œë ¥ ì—†ìŒ)
  npx tsc --project tsconfig.app.json --noEmit --skipLibCheck --pretty
  if [ $? -ne 0 ]; then
    echo "âŒ TypeScript íƒ€ì… ì˜¤ë¥˜"
    exit 1
  fi

  # ESLint ê²€ì‚¬
  npx eslint --fix "src/**/*.{ts,tsx}"
  if [ $? -ne 0 ]; then
    echo "âŒ ESLint ê²€ì‚¬ ì‹¤íŒ¨"
    exit 1
  fi

  # Prettier ê²€ì‚¬
  npx prettier --check --write "src/**/*.{ts,tsx,css,scss,md,html,json}"
  if [ $? -ne 0 ]; then
    echo "âŒ Prettier í¬ë§· ì˜¤ë¥˜. 'npm run format'ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”."
    exit 1
  fi

  cd ..
else
  echo "âœ… í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ ì—†ìŒ: ê²€ì‚¬ ê±´ë„ˆëœ€"
fi

# ë°±ì—”ë“œ ê²€ì‚¬
if [ ! -z "$backend_changes" ]; then
  echo "ğŸ§ª ë°±ì—”ë“œ ë³€ê²½ ê°ì§€: Checkstyle ê²€ì‚¬ ì‹œì‘..."
  cd $backend_project_path
  ./gradlew check
  if [ $? -ne 0 ]; then
    echo "âŒ Checkstyle ê²€ì‚¬ ì‹¤íŒ¨"
    exit 1
  fi
  cd ..
else
  echo "âœ… ë°±ì—”ë“œ ë³€ê²½ ì—†ìŒ: ê²€ì‚¬ ê±´ë„ˆëœ€"
fi
